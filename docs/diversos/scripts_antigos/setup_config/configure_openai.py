#!/usr/bin/env python3
"""
Script para configurar a API Key da OpenAI
"""

import os

def configure_openai_key():
    """Configura a API Key da OpenAI no arquivo .env"""
    
    print("üîß Configurando API Key da OpenAI...")
    
    # Sua chave (voc√™ precisa fornecer a chave completa)
    api_key = input("Digite sua API Key completa da OpenAI (sk-proj-...): ").strip()
    
    if not api_key.startswith('sk-'):
        print("‚ùå Formato de API Key inv√°lido. Deve come√ßar com 'sk-'")
        return False
    
    # Conte√∫do do arquivo .env
    env_content = f"""# APP25 Configuration
# Generated by integrations page

# Database
DATABASE_URL=sqlite:///pevapp22.db
DEV_DATABASE_URL=sqlite:///pevapp22_dev.db

# Security
SECRET_KEY=dev-secret-key-change-in-production
LOGIN_DISABLED=False

# Email Configuration
MAIL_SERVER=
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=
MAIL_PASSWORD=
MAIL_DEFAULT_SENDER=

# AI Integration
AI_PROVIDER=openai
AI_API_KEY={api_key}
AI_WEBHOOK_URL=

# WhatsApp Integration
WHATSAPP_PROVIDER=disabled
WHATSAPP_API_KEY=
WHATSAPP_WEBHOOK_URL=

# File Uploads
UPLOAD_FOLDER=uploads
PDF_TEMP_FOLDER=temp_pdfs

# Redis
REDIS_URL=redis://localhost:6379/0

# Environment
FLASK_ENV=development"""
    
    try:
        # Salvar arquivo .env
        with open('.env', 'w', encoding='utf-8') as f:
            f.write(env_content)
        
        print("‚úÖ Arquivo .env criado com sucesso!")
        print(f"‚úÖ API Key configurada: {api_key[:10]}...")
        print("‚úÖ Provedor: OpenAI")
        
        return True
        
    except Exception as e:
        print(f"‚ùå Erro ao criar arquivo .env: {e}")
        return False

def test_configuration():
    """Testa a configura√ß√£o"""
    print("\nüß™ Testando configura√ß√£o...")
    
    try:
        from dotenv import load_dotenv
        load_dotenv()
        
        provider = os.environ.get('AI_PROVIDER', 'n√£o definido')
        api_key = os.environ.get('AI_API_KEY', 'n√£o definida')
        
        print(f"‚úÖ Provedor: {provider}")
        print(f"‚úÖ API Key: {api_key[:10]}..." if api_key != 'n√£o definida' else "‚ùå API Key n√£o encontrada")
        
        if provider == 'openai' and api_key.startswith('sk-'):
            print("üéâ Configura√ß√£o v√°lida!")
            return True
        else:
            print("‚ùå Configura√ß√£o inv√°lida")
            return False
            
    except Exception as e:
        print(f"‚ùå Erro ao testar: {e}")
        return False

if __name__ == '__main__':
    print("üöÄ Configurador de API Key da OpenAI")
    print("=" * 40)
    
    if configure_openai_key():
        test_configuration()
        
        print("\nüìã Pr√≥ximos passos:")
        print("1. Execute: python app_pev.py")
        print("2. Acesse: http://localhost:5000/dashboard")
        print("3. V√° para 'Status dos Servi√ßos'")
        print("4. Verifique se a IA est√° 'Ativo'")
        print("5. Teste executando um agente")
    else:
        print("\n‚ùå Configura√ß√£o falhou. Tente novamente.")
