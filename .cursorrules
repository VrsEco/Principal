# Regras do Cursor AI para o Projeto GestaoVersus

## üéØ Contexto do Projeto

Este √© um sistema de gest√£o empresarial modular constru√≠do com:
- **Backend:** Python 3.9+ + Flask 2.3.3
- **Database:** PostgreSQL (prod) / SQLite (dev) com SQLAlchemy 2.0.21
- **Arquitetura:** Modular com Blueprints (PEV, GRV, Meetings)
- **Frontend:** Jinja2 Templates + JavaScript Vanilla

## üìö Governan√ßa

**IMPORTANTE:** Consultar sempre antes de propor mudan√ßas:
- `/docs/governance/TECH_STACK.md` - Stack aprovada
- `/docs/governance/ARCHITECTURE.md` - Arquitetura do sistema
- `/docs/governance/CODING_STANDARDS.md` - Padr√µes de c√≥digo
- `/docs/governance/DATABASE_STANDARDS.md` - Padr√µes de banco
- `/docs/governance/API_STANDARDS.md` - Padr√µes de API
- `/docs/governance/FORBIDDEN_PATTERNS.md` - Anti-patterns proibidos
- `/docs/governance/DECISION_LOG.md` - Decis√µes arquiteturais

## ‚úÖ Regras Obrigat√≥rias

### 1. Stack Tecnol√≥gica
- ‚úÖ **USAR:** Python, Flask, SQLAlchemy, PostgreSQL, SQLite, bcrypt
- ‚ùå **NUNCA SUGERIR:** Django, FastAPI, MongoDB, MySQL, jQuery, TypeScript, GraphQL
- ‚ö†Ô∏è **Nova depend√™ncia?** Justificar e documentar em DECISION_LOG.md

### 2. C√≥digo Python
- ‚úÖ Seguir PEP 8 (com max-line-length=120)
- ‚úÖ Usar Black para formata√ß√£o autom√°tica
- ‚úÖ Type hints em fun√ß√µes p√∫blicas
- ‚úÖ Docstrings em fun√ß√µes/classes p√∫blicas (formato Google)
- ‚úÖ snake_case para vari√°veis/fun√ß√µes, PascalCase para classes
- ‚ùå NUNCA usar `eval()`, `exec()`, bare `except:`
- ‚ùå NUNCA fazer import circular

### 3. Banco de Dados
- ‚úÖ C√≥digo DEVE funcionar em PostgreSQL E SQLite
- ‚úÖ Usar `db.Column(db.JSON)` (n√£o JSONB)
- ‚úÖ Usar soft delete (`is_deleted=True`) ao inv√©s de hard delete
- ‚úÖ Sempre adicionar: `created_at`, `updated_at`, `is_deleted`
- ‚úÖ Sempre paginar queries que retornam listas
- ‚úÖ Usar eager loading para evitar N+1 queries
- ‚ùå NUNCA usar tipos espec√≠ficos PostgreSQL (JSONB, ARRAY, UUID)
- ‚ùå NUNCA concatenar strings em SQL (usar ORM ou par√¢metros)

### 4. APIs REST
- ‚úÖ URLs: `/api/resources` (plural, snake_case)
- ‚úÖ M√©todos: GET (listar), POST (criar), PUT (atualizar), DELETE (remover)
- ‚úÖ Status codes: 200 (OK), 201 (Created), 400 (Bad Request), 401 (Unauthorized), 403 (Forbidden), 404 (Not Found)
- ‚úÖ Response format: `{"success": bool, "data": ..., "error": ...}`
- ‚úÖ Sempre usar `@login_required` em rotas protegidas
- ‚úÖ Sempre usar `@auto_log_crud(entity_type)` em rotas CRUD
- ‚ùå NUNCA usar GET para modificar dados
- ‚ùå NUNCA expor stack trace ao cliente

### 5. Seguran√ßa
- ‚ùå **PROIBIDO:** Credenciais hardcoded
- ‚ùå **PROIBIDO:** SQL injection (usar ORM)
- ‚ùå **PROIBIDO:** Senhas em plain text (usar bcrypt)
- ‚ùå **PROIBIDO:** Logar dados sens√≠veis (senha, token, cart√£o)
- ‚úÖ Sempre validar input do usu√°rio
- ‚úÖ Sempre usar `@login_required` em rotas protegidas
- ‚úÖ Sempre verificar permiss√µes antes de opera√ß√µes cr√≠ticas

### 6. Arquitetura
- ‚úÖ Organiza√ß√£o: `models/` ‚Üí `services/` ‚Üí `modules/` (blueprints) ‚Üí `templates/`
- ‚úÖ Novos m√≥dulos: criar em `modules/[nome]/` com blueprint
- ‚úÖ L√≥gica de neg√≥cio: sempre em `services/`, NUNCA em rotas
- ‚úÖ Templates: apenas apresenta√ß√£o, NUNCA queries ou l√≥gica
- ‚ùå NUNCA l√≥gica de neg√≥cio em templates
- ‚ùå NUNCA acessar models diretamente de rotas (usar services)

## üîÑ Fluxo de Trabalho

### Quando Criar Nova Feature

1. **Planejar:**
   - Verificar se stack atual suporta
   - Consultar FORBIDDEN_PATTERNS.md
   - Usar template em `/docs/templates/feature_template.md`

2. **Implementar:**
   - Seguir CODING_STANDARDS.md
   - Adicionar testes
   - Adicionar `@auto_log_crud` em rotas CRUD

3. **Validar:**
   - Rodar `black .` para formatar
   - Rodar `flake8` para linting
   - Rodar `pytest` para testes
   - Verificar se funciona em PostgreSQL e SQLite

4. **Documentar:**
   - Atualizar README se necess√°rio
   - Adicionar docstrings
   - Se decis√£o arquitetural importante, documentar em DECISION_LOG.md

### Quando Sugerir C√≥digo

1. **Analisar contexto:**
   - Ler arquivos relacionados
   - Entender padr√£o existente
   - Verificar governan√ßa

2. **Propor solu√ß√£o:**
   - Seguir padr√µes existentes
   - Incluir valida√ß√£o e error handling
   - Incluir docstrings
   - Sugerir testes se relevante

3. **Explicar:**
   - Por que essa abordagem
   - Quais alternativas foram consideradas
   - Trade-offs da solu√ß√£o

## üìã Templates Dispon√≠veis

- `/docs/templates/feature_template.md` - Nova feature
- `/docs/templates/bugfix_template.md` - Corre√ß√£o de bug
- `/docs/templates/module_template.md` - Novo m√≥dulo

## üö´ Anti-Patterns (NUNCA FAZER)

Consultar `/docs/governance/FORBIDDEN_PATTERNS.md` para lista completa.

**Cr√≠ticos:**
- ‚ùå Credenciais hardcoded
- ‚ùå SQL injection
- ‚ùå Senhas sem hash
- ‚ùå Logar dados sens√≠veis
- ‚ùå GET modificando dados
- ‚ùå Rotas sem autentica√ß√£o
- ‚ùå Queries sem pagina√ß√£o
- ‚ùå Usar `eval()` ou `exec()`

## üé® Exemplos de C√≥digo Correto

### Rota CRUD Completa
```python
from flask import Blueprint, request, jsonify
from flask_login import login_required, current_user
from middleware.auto_log_decorator import auto_log_crud
from models import db, Project

api = Blueprint('projects', __name__, url_prefix='/api')

@api.route('/companies/<int:company_id>/projects', methods=['POST'])
@login_required
@auto_log_crud('project')
def create_project(company_id):
    """Cria novo projeto."""
    data = request.get_json()
    
    # Valida√ß√£o
    if not data or 'name' not in data:
        return jsonify({'success': False, 'error': 'Nome obrigat√≥rio'}), 400
    
    # Criar
    project = Project(
        name=data['name'],
        description=data.get('description'),
        company_id=company_id,
        created_by=current_user.id
    )
    
    db.session.add(project)
    db.session.commit()
    
    return jsonify({'success': True, 'data': project.to_dict()}), 201
```

### Model com Auditoria
```python
from models import db
from datetime import datetime

class Project(db.Model):
    """Modelo de Projeto."""
    
    __tablename__ = 'projects'
    
    # PK
    id = db.Column(db.Integer, primary_key=True)
    
    # Campos
    name = db.Column(db.String(200), nullable=False)
    description = db.Column(db.Text)
    
    # FK
    company_id = db.Column(db.Integer, db.ForeignKey('companies.id'), nullable=False)
    
    # Auditoria
    created_at = db.Column(db.DateTime, default=datetime.utcnow, nullable=False)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    is_deleted = db.Column(db.Boolean, default=False, nullable=False)
    
    # Relacionamentos
    company = db.relationship('Company', backref='projects')
    
    def to_dict(self):
        """Serializa para dict."""
        return {
            'id': self.id,
            'name': self.name,
            'description': self.description,
            'company_id': self.company_id,
            'created_at': self.created_at.isoformat() if self.created_at else None
        }
```

## üí° Dicas de Prompt

Quando me perguntar algo, forne√ßa:
1. **Contexto:** O que voc√™ est√° tentando fazer
2. **Problema:** Qual erro ou d√∫vida espec√≠fica
3. **Tentativas:** O que j√° tentou (se aplic√°vel)
4. **Arquivos:** Mencione arquivos relevantes para eu ler

Exemplo bom:
> "Preciso criar uma rota para atualizar indicadores. O modelo est√° em models/indicator.py e j√° existe uma rota de cria√ß√£o em modules/grv/__init__.py. Como fazer seguindo os padr√µes do projeto?"

Exemplo ruim:
> "Como atualizar indicador?"

## üîç Como me Usar Melhor

1. **Leia a governan√ßa primeiro:** Muitas d√∫vidas j√° est√£o respondidas em `/docs/governance/`
2. **Seja espec√≠fico:** Quanto mais contexto, melhor minha resposta
3. **Pe√ßa valida√ß√£o:** "Isso segue os padr√µes do projeto?"
4. **Pe√ßa explica√ß√£o:** "Por que fazer assim ao inv√©s de X?"
5. **Pe√ßa alternativas:** "Quais outras formas de resolver isso?"

## üìä Prioridades

1. **Seguran√ßa** - Sempre em primeiro lugar
2. **Compatibilidade** - C√≥digo deve funcionar em PostgreSQL e SQLite
3. **Padr√µes** - Seguir governan√ßa do projeto
4. **Performance** - Evitar N+1, paginar, eager loading
5. **Manutenibilidade** - C√≥digo leg√≠vel e bem documentado

## ‚ú® Filosofia do Projeto

> "Preferimos c√≥digo simples, expl√≠cito e bem documentado. Evitamos abstra√ß√µes prematuras e depend√™ncias desnecess√°rias. Cada linha de c√≥digo deve ter um prop√≥sito claro e estar coberta por testes."

---

**Vers√£o:** 1.0  
**√öltima atualiza√ß√£o:** 18/10/2025  
**Manter este arquivo atualizado com a governan√ßa!**



