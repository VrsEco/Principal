?<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gest√£o de Reuni√µes - Versus Gestao Corporativa</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
  <link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/img/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/main.css" />
  <link rel="stylesheet" href="/static/css/grv-global-pattern.css" />
  <link id="themeStylesheet" rel="stylesheet" href="" />
  <style>
    .header-nav {
      display: flex;
      gap: 16px;
      margin-right: 20px;
    }
    
    .header-nav a.nav-link {
      color: #ffffff !important;
      text-decoration: none;
      font-weight: 600;
      padding: 8px 18px;
      border-radius: 999px;
      transition: all 0.25s;
      font-size: 14px;
      background: rgba(58, 241, 174, 0.08);
      border: 1px solid rgba(58, 241, 174, 0.22);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.24);
      backdrop-filter: blur(6px);
    }
    
    .header-nav a.nav-link:hover {
      background: rgba(58, 241, 174, 0.18) !important;
      color: #ffffff !important;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.28);
      transform: translateY(-2px);
    }
    
    .header-nav a.nav-link.active {
      background: rgba(58, 241, 174, 0.24) !important;
      color: #ffffff !important;
      border-color: rgba(58, 241, 174, 0.45);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
    }
    
    .app-header {
      background: linear-gradient(135deg, rgba(6, 8, 8, 0.96) 0%, rgba(9, 13, 11, 0.94) 65%, rgba(6, 8, 8, 0.98) 100%) !important;
      border-bottom: 1px solid rgba(58, 241, 174, 0.32) !important;
      backdrop-filter: blur(18px) !important;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.48) !important;
    }
    
    .header-brand {
      padding: 8px 20px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(58, 241, 174, 0.06) 0%, rgba(58, 241, 174, 0.02) 100%);
      border: 1px solid rgba(58, 241, 174, 0.28);
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.42), 0 18px 36px rgba(0, 0, 0, 0.32);
    }
    
    .user-pill {
      background: rgba(58, 241, 174, 0.12) !important;
      border: 1px solid rgba(58, 241, 174, 0.32) !important;
      border-radius: 999px !important;
      padding: 8px 16px !important;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3) !important;
    }
    
    .user-name {
      color: #f8fafc !important;
      font-weight: 600 !important;
      font-size: 14px !important;
    }
    
    #themeSelect {
      background: rgba(9, 13, 11, 0.8) !important;
      color: #e2fdf3 !important;
      border: 1px solid rgba(58, 241, 174, 0.3) !important;
      border-radius: 12px !important;
      padding: 8px 12px !important;
      font-size: 14px !important;
      font-weight: 500 !important;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.28);
    }
    
    #themeSelect option {
      background: #0b120f !important;
      color: #e2fdf3 !important;
    }
  </style>
  

<style>
  .app-main {
    padding-bottom: 80px;
  }

  /* Melhorar o fundo do container principal */
  .surface-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid rgba(30, 64, 175, 0.1);
    box-shadow: 0 8px 24px rgba(30, 64, 175, 0.08);
  }

  /* Cards de reuni√µes com cores baseadas no status */
  .meeting-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid rgba(15, 23, 42, 0.08);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .meeting-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #94a3b8, #3b82f6);
    opacity: 0.7;
  }

  /* Cores espec√≠ficas para cards baseadas no status */
  .meeting-card[data-status="draft"]::before {
    background: linear-gradient(90deg, #94a3b8, #64748b);
  }

  .meeting-card[data-status="in_progress"]::before {
    background: linear-gradient(90deg, #fbbf24, #f59e0b);
  }

  .meeting-card[data-status="completed"]::before {
    background: linear-gradient(90deg, #10b981, #059669);
  }

  /* Bot√µes melhorados */
  .button.button-primary {
    background: linear-gradient(135deg, #1e40af, #7c3aed, #dc2626);
    color: white;
    box-shadow: 0 16px 28px rgba(30, 64, 175, 0.3);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .button.button-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  .button.button-primary:hover::before {
    left: 100%;
  }

  /* Badges de status melhorados */
  .meeting-card [style*="background: #e5e7eb"] {
    background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(100, 116, 139, 0.15)) !important;
    color: #1e293b !important;
    border: 1px solid rgba(148, 163, 184, 0.3) !important;
    box-shadow: 0 2px 4px rgba(148, 163, 184, 0.1) !important;
  }

  .meeting-card [style*="background: #dbeafe"] {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.15)) !important;
    color: #a16207 !important;
    border: 1px solid rgba(251, 191, 36, 0.3) !important;
    box-shadow: 0 2px 4px rgba(251, 191, 36, 0.1) !important;
  }

  .meeting-card [style*="background: #d1fae5"] {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(5, 150, 105, 0.15)) !important;
    color: #047857 !important;
    border: 1px solid rgba(34, 197, 94, 0.3) !important;
    box-shadow: 0 2px 4px rgba(34, 197, 94, 0.1) !important;
  }

  /* Estado vazio melhorado */
  .empty-state {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border: 1px dashed rgba(30, 64, 175, 0.2);
  }

  /* Tabs melhoradas */
  .tab-btn {
    padding: 12px 20px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: #64748b;
    transition: all 0.2s ease;
    position: relative;
  }

  .tab-btn:hover {
    color: #0f172a;
    background: rgba(15, 23, 42, 0.04);
  }

  .tab-btn.active {
    color: #1e40af;
    border-bottom-color: #1e40af;
    background: linear-gradient(135deg, rgba(30, 64, 175, 0.05), rgba(124, 58, 237, 0.05));
  }

  /* Listas melhoradas */
  .guest-item, .agenda-item, .participant-item {
    background: linear-gradient(135deg, rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.6));
    border: 1px solid rgba(30, 64, 175, 0.1);
    transition: all 0.2s ease;
  }

  .guest-item:hover, .agenda-item:hover, .participant-item:hover {
    background: linear-gradient(135deg, rgba(248, 250, 252, 1), rgba(241, 245, 249, 0.8));
    border-color: rgba(30, 64, 175, 0.2);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(30, 64, 175, 0.1);
  }

  /* Bot√µes de perigo melhorados */
  .btn-danger {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    color: white;
    border: none;
    transition: all 0.2s ease;
  }

  .btn-danger:hover {
    background: linear-gradient(135deg, #b91c1c, #991b1b);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
  }

  /* Sobrescrever regras globais para garantir cores escuras */
  .surface-card,
  .surface-card *,
  .meeting-card,
  .meeting-card *,
  .tab-btn,
  .form-input,
  .form-textarea {
    color: #1e293b !important;
  }

  .meeting-card h4,
  .meeting-card strong,
  .form-label {
    color: #0f172a !important;
  }
</style>

</head>
<body class="">

  <div class="app-shell">
    <header class="app-header">
      <div class="header-brand">
        <img class="header-banner" src="/static/img/header-banner.png" alt="Versus banner" />
      </div>
      <div class="header-actions">
        
        <div class="header-nav">
          <a href="/main" class="nav-link">Ecossistema</a>
          <a href="/pev/dashboard" class="nav-link">PEV</a>
          <a href="/grv/dashboard" class="nav-link">GRV</a>
        </div>
        <div class="user-pill">
          <span class="user-name">Usuario</span>
        </div>
        <div class="header-nav">
          <select id="themeSelect" class="nav-link" style="padding:8px 12px; color: #0f172a; background:#ffffff; border:1px solid rgba(15,23,42,0.15);">
            <option value="versus">Tema Versus</option>
            <option value="alt">Tema Azul/Branco/Amarelo</option>
          </select>
        </div>
        
      </div>
    </header>

    <main class="app-main">
      <!-- Flash Messages -->
      
        
      
      
      
<div class="project-layout plan-layout" data-sidebar-toggle>
    
    

<aside class="project-sidebar surface-card plan-sidebar">
    <span class="project-sidebar-title">Reuniıes</span>
    <nav class="project-nav">
        
        <div class="project-nav-group">
            
            <span class="project-nav-group-title">Gest„o de Reuniıes</span>
            
            
            
            
            
            <a class="project-nav-link is-active"
               href="/meetings/company/13/list"
               title="Gerenciar reuniıes da empresa">
                <span>Gerenciar Reuniıes</span>
            </a>
            
        </div>
        
        <div class="project-nav-group">
            
            <span class="project-nav-group-title">Voltar</span>
            
            
            
            
            
            <a class="project-nav-link"
               href="/grv/company/13"
               title="Voltar para o dashboard">
                <span>? Dashboard da Empresa</span>
            </a>
            
        </div>
        
    </nav>
    
    
    <div class="project-hints plan-sidebar-meta">
        <span class="summary-eyebrow">Empresa</span>
        <p><strong>Save Water</strong></p>
    </div>
    
</aside>
    
    <section class="project-content plan-content" data-company-id="13">
        <div class="surface-card" style="margin-top:16px;padding:24px;">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:flex-start;gap:16px;">
                <div>
                    <span class="section-eyebrow">Gest√£o de Reuni√µes</span>
                    <h3>Gerenciar Reuni√µes</h3>
                    <p class="text-muted" style="margin-top:8px;max-width:640px;">
                        Organize e gerencie reuni√µes da empresa com dados preliminares, execu√ß√£o e atividades geradas.
                    </p>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    <button type="button" class="button button-primary" onclick="novaReuniao()">+ Nova Reuni√£o</button>
                </div>
            </div>

            <div id="meetings-list-section">
                <!-- Lista de Reuni√µes -->
                <div style="margin-top: 24px;">
                    <div id="meetings-grid" class="meetings-grid" style="display: grid; gap: 14px;">
                        
                        <div class="meeting-card" data-status="completed" style="padding: 16px; border-radius: 12px; background: #ffffff; border: 1px solid rgba(15, 23, 42, 0.08); transition: all 0.2s ease; cursor: pointer;" 
                             onclick="console.log('??? Meeting card clicked, ID:', 3); editarReuniao(3)"
                             role="button"
                             tabindex="0"
                             onkeydown="if (event.key === 'Enter' || event.key === ' ') { event.preventDefault(); console.log('?? Meeting card keydown, ID:', 3); editarReuniao(3); }"
                             onmouseover="this.style.boxShadow='0 10px 24px rgba(15, 23, 42, 0.12)'; this.style.borderColor='rgba(37, 99, 235, 0.35)';"
                             onmouseout="this.style.boxShadow=''; this.style.borderColor='rgba(15, 23, 42, 0.08)';">
                            <div style="display: flex; justify-content: space-between; align-items: start; gap: 12px;">
                                <div style="flex: 1; cursor: pointer;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #0f172a;">Reuni„o Semanal Gerencial</h4>
                                    <div style="color: #64748b; font-size: 14px; display: flex; gap: 12px; align-items: center;">
                                        <span>üìÖ 2025-10-14</span>
                                        <span>üïê 09:00</span>
                                    </div>
                                    
                                    <div style="margin-top: 8px;">
                                        
                                        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; background: #d1fae5; color: #065f46;">Conclu√≠da</span>
                                        
                                    </div>
                                    
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center; margin-top: 10px;">
                                    <button type="button" 
                                            class="button button-sm button-outline" 
                                            onclick="event.stopPropagation(); gerarRelatorioReuniao(3)"
                                            title="Gerar relat√≥rio desta reuni√£o">
                                        üìÑ Relat√≥rio
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="meeting-card" data-status="completed" style="padding: 16px; border-radius: 12px; background: #ffffff; border: 1px solid rgba(15, 23, 42, 0.08); transition: all 0.2s ease; cursor: pointer;" 
                             onclick="console.log('??? Meeting card clicked, ID:', 4); editarReuniao(4)"
                             role="button"
                             tabindex="0"
                             onkeydown="if (event.key === 'Enter' || event.key === ' ') { event.preventDefault(); console.log('?? Meeting card keydown, ID:', 4); editarReuniao(4); }"
                             onmouseover="this.style.boxShadow='0 10px 24px rgba(15, 23, 42, 0.12)'; this.style.borderColor='rgba(37, 99, 235, 0.35)';"
                             onmouseout="this.style.boxShadow=''; this.style.borderColor='rgba(15, 23, 42, 0.08)';">
                            <div style="display: flex; justify-content: space-between; align-items: start; gap: 12px;">
                                <div style="flex: 1; cursor: pointer;">
                                    <h4 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: #0f172a;">Teste Fabiano Reuni„o 02</h4>
                                    <div style="color: #64748b; font-size: 14px; display: flex; gap: 12px; align-items: center;">
                                        <span>üìÖ 2025-10-17</span>
                                        <span>üïê 10:00</span>
                                    </div>
                                    
                                    <div style="margin-top: 8px;">
                                        
                                        <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; background: #d1fae5; color: #065f46;">Conclu√≠da</span>
                                        
                                    </div>
                                    
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center; margin-top: 10px;">
                                    <button type="button" 
                                            class="button button-sm button-outline" 
                                            onclick="event.stopPropagation(); gerarRelatorioReuniao(4)"
                                            title="Gerar relat√≥rio desta reuni√£o">
                                        üìÑ Relat√≥rio
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                    
                </div>
            </div>

            <!-- Editor de Reuni√£o (3 Abas) -->
            <div class="meeting-editor-section" id="meeting-editor-section" style="display: none; margin-top: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid rgba(15, 23, 42, 0.08);">
                    <div>
                        <span class="section-eyebrow">Editor</span>
                        <h3 id="meeting-editor-title" style="margin: 4px 0 0 0;">Nova Reuni√£o</h3>
                    </div>
                    <button type="button" onclick="fecharEditor()" class="button button-ghost">‚Üê Voltar √† Lista</button>
                </div>
                
                <input type="hidden" id="current-meeting-id" value="">
                
                <!-- Tabs -->
                <div class="tabs-container" style="border-bottom: 2px solid rgba(15, 23, 42, 0.08); margin-bottom: 24px;">
                    <div class="tabs" style="display: flex; gap: 8px;">
                        <button class="tab-btn active" onclick="trocarAba('preliminares')" id="tab-preliminares" type="button">
                            Dados Preliminares / Convites
                        </button>
                        <button class="tab-btn" onclick="trocarAba('execucao')" id="tab-execucao" type="button">
                            Execu√ß√£o da Reuni√£o
                        </button>
                        <button class="tab-btn" onclick="trocarAba('atividades')" id="tab-atividades" type="button">
                            Atividades Geradas
                        </button>
                    </div>
                </div>
                    
                    <!-- ABA 1: Dados Preliminares / Convites -->
                    <div class="tab-content active" id="content-preliminares">
                        <div class="form-section">
                            <div class="form-group">
                                <label class="form-label">T√≠tulo da Reuni√£o *</label>
                                <input type="text" id="meeting-title" class="form-input" placeholder="Ex: Planejamento Estrat√©gico Q4">
                            </div>
                            
                            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Data Prevista</label>
                                    <input type="date" id="meeting-scheduled-date" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hora Prevista</label>
                                    <input type="time" id="meeting-scheduled-time" class="form-input">
                                </div>
                            </div>
                            
                            <!-- Convidados da Organiza√ß√£o -->
                            <div class="form-group">
                                <label class="form-label">Convidados da Organiza√ß√£o</label>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <select id="employee-select" class="form-input" style="flex: 1;">
                                        <option value="">Selecione um colaborador...</option>
                                        
                                        <option value="13" 
                                                data-name="Erika"
                                                data-email=""
                                                data-whatsapp="">
                                            Erika
                                        </option>
                                        
                                        <option value="25" 
                                                data-name="Fabiano"
                                                data-email=""
                                                data-whatsapp="">
                                            Fabiano
                                        </option>
                                        
                                        <option value="16" 
                                                data-name="Joseane"
                                                data-email=""
                                                data-whatsapp="">
                                            Joseane
                                        </option>
                                        
                                        <option value="15" 
                                                data-name="Manoel"
                                                data-email=""
                                                data-whatsapp="">
                                            Manoel
                                        </option>
                                        
                                        <option value="12" 
                                                data-name="Marcel"
                                                data-email=""
                                                data-whatsapp="">
                                            Marcel
                                        </option>
                                        
                                        <option value="17" 
                                                data-name="Thais"
                                                data-email=""
                                                data-whatsapp="">
                                            Thais
                                        </option>
                                        
                                        <option value="14" 
                                                data-name="Vicente"
                                                data-email=""
                                                data-whatsapp="">
                                            Vicente
                                        </option>
                                        
                                        <option value="26" 
                                                data-name="Wagner"
                                                data-email=""
                                                data-whatsapp="">
                                            Wagner
                                        </option>
                                        
                                    </select>
                                    <button type="button" class="button button-secondary" onclick="adicionarColaborador()">+ Adicionar</button>
                                </div>
                                <div id="guests-internal-list" class="guests-list"></div>
                            </div>
                            
                            <!-- Convidados Externos -->
                            <div class="form-group">
                                <label class="form-label">Convidados Externos</label>
                                <div style="display: grid; grid-template-columns: 2fr 2fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <input type="text" id="external-name" class="form-input" placeholder="Nome">
                                    <input type="email" id="external-email" class="form-input" placeholder="E-mail">
                                    <input type="text" id="external-whatsapp" class="form-input" placeholder="WhatsApp">
                                    <button type="button" class="button button-secondary" onclick="adicionarExterno()">+ Adicionar</button>
                                </div>
                                <div id="guests-external-list" class="guests-list"></div>
                            </div>
                            
                            <!-- Pauta -->
                            <div class="form-group">
                                <label class="form-label">Pauta da Reuni√£o</label>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <input type="text" id="agenda-item-input" class="form-input" placeholder="Digite um t√≥pico da pauta" style="flex: 1;">
                                    <button type="button" class="button button-secondary" onclick="adicionarPauta()">+ Adicionar</button>
                                    <button type="button" class="button button-secondary" onclick="mostrarPautaSalva()">üìã Reutilizar</button>
                                </div>
                                <div id="agenda-list" class="agenda-list"></div>
                                
                                <!-- Modal para selecionar pauta salva -->
                                <div id="saved-agenda-modal" style="display: none; margin-top: 0.5rem; padding: 1rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--surface-hover);">
                                    <h4 style="margin: 0 0 0.5rem 0;">Pautas Salvas</h4>
                                    <div id="saved-agenda-list" style="max-height: 200px; overflow-y: auto;">
                                        
                                    </div>
                                    <button type="button" class="button button-small button-ghost" onclick="fecharPautaSalva()" style="margin-top: 8px;">Fechar</button>
                                </div>
                            </div>
                            
                            <!-- Observa√ß√µes -->
                            <div class="form-group">
                                <label class="form-label">Observa√ß√µes do Convite</label>
                                <textarea id="meeting-invite-notes" class="form-textarea" rows="4" 
                                          placeholder="Informa√ß√µes adicionais para os convidados..."></textarea>
                            </div>
                            
                            <!-- Bot√µes -->
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" class="button button-ghost" onclick="fecharEditor()">Cancelar</button>
                                <button type="button" class="button button-primary" onclick="salvarPreliminares()">üíæ Salvar Dados Preliminares</button>
                                <button type="button" class="button button-success" onclick="gerarConvite()">üìß Gerar Convite (.ics)</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ABA 2: Execu√ß√£o da Reuni√£o -->
                    <div class="tab-content" id="content-execucao" style="display: none;">
                        <div class="form-section">
                            <div style="background: var(--primary-color-light); padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                                <p style="margin: 0; color: var(--text-primary);">
                                    <strong>Status:</strong> <span id="meeting-status-display">Rascunho</span>
                                </p>
                                <button type="button" class="button button-success" onclick="iniciarReuniao()" id="btn-iniciar-reuniao" style="margin-top: 8px;">
                                    ‚ñ∂Ô∏è Iniciar Reuni√£o
                                </button>
                            </div>
                            
                            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Data da Realiza√ß√£o</label>
                                    <input type="date" id="meeting-actual-date" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hora da Realiza√ß√£o</label>
                                    <input type="time" id="meeting-actual-time" class="form-input">
                                </div>
                            </div>
                            
                            <!-- Participantes -->
                            <div class="form-group">
                                <label class="form-label">Participantes (Quem efetivamente participou)</label>
                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    Selecione dos convidados ou adicione novos participantes
                                </p>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <select id="participant-select" class="form-input" style="flex: 1;">
                                        <option value="">Selecionar dos convidados...</option>
                                    </select>
                                    <button type="button" class="button button-secondary" onclick="adicionarParticipante()">+ Adicionar</button>
                                </div>
                                <div id="participants-list" class="participants-list"></div>
                            </div>
                            
                            <!-- Assuntos Discutidos -->
                            <div class="form-group">
                                <label class="form-label">Assuntos Discutidos</label>
                                <div id="discussions-list" class="discussions-list"></div>
                                <button type="button" class="button button-secondary" onclick="adicionarDiscussao()">+ Adicionar Discuss√£o</button>
                            </div>
                            
                            <!-- Atividades Cadastradas -->
                            <div class="form-group">
                                <label class="form-label">Atividades Cadastradas</label>
                                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    Atividades ser√£o adicionadas ao projeto da reuni√£o
                                </p>
                                <div id="activities-list" class="activities-list"></div>
                                <div style="display: flex; gap: 8px; margin-top: 8px;">
                                    <button type="button" class="button button-secondary" onclick="adicionarAtividade()">+ Adicionar Atividade</button>
                                    <button type="button" class="button button-outline" onclick="atualizarListaAtividades(this)" id="sync-activities-btn">
                                        üîÑ Atualizar Lista
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Notas Gerais -->
                            <div class="form-group">
                                <label class="form-label">Notas Gerais da Reuni√£o</label>
                                <textarea id="meeting-notes" class="form-textarea" rows="4" 
                                          placeholder="Observa√ß√µes gerais sobre a reuni√£o..."></textarea>
                            </div>
                            
                            <!-- Bot√µes -->
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" class="button button-secondary" onclick="salvarExecucao()">üíæ Salvar Execu√ß√£o</button>
                                <button type="button" class="button button-success" onclick="finalizarReuniao()" id="btn-finalizar-reuniao">
                                    ‚úÖ Finalizar Reuni√£o
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ABA 3: Atividades Geradas -->
                    <div class="tab-content" id="content-atividades" style="display: none;">
                        <div class="form-section">
                            <div style="background: var(--surface-hover); padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                                <p style="margin: 0;">
                                    <strong>Projeto Vinculado:</strong> <span id="project-link-display">Nenhum</span>
                                </p>
                            </div>
                            
                            <h3 style="margin-bottom: 1rem;">Atividades Geradas nesta Reuni√£o</h3>
                            <div id="generated-activities-list" class="generated-activities-list"></div>
                            
                            <button type="button" class="button button-primary" onclick="atualizarAtividades()" style="margin-top: 16px;">
                                üîÑ Atualizar Lista
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<style>
/* Tab Buttons */
.tab-btn {
    padding: 12px 20px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: #64748b;
    transition: all 0.2s ease;
}

.tab-btn:hover {
    color: #0f172a;
    background: rgba(15, 23, 42, 0.04);
}

.tab-btn.active {
    color: #2563eb;
    border-bottom-color: #2563eb;
}

.tab-content {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Form Groups */
.form-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-label {
    font-size: 14px;
    font-weight: 600;
    color: #0f172a;
}

.form-input, .form-textarea {
    padding: 10px 14px;
    border: 1px solid rgba(15, 23, 42, 0.12);
    border-radius: 8px;
    font-size: 14px;
    color: #0f172a;
    background: #ffffff;
    transition: all 0.2s ease;
}

.form-input:focus, .form-textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-row {
    display: grid;
    gap: 16px;
}

/* Lists */
.guests-list, .agenda-list, .participants-list, .discussions-list, .activities-list, .generated-activities-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.guest-item, .agenda-item, .participant-item, .discussion-item, .activity-item {
    padding: 12px;
    background: rgba(248, 250, 252, 0.8);
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
}

.guest-item:hover, .agenda-item:hover, .participant-item:hover {
    background: rgba(248, 250, 252, 1);
    border-color: rgba(15, 23, 42, 0.12);
}

/* Button utilities for inline forms */
.btn-sm {
    padding: 6px 12px;
    font-size: 13px;
    border-radius: 6px;
}

.btn-danger {
    background: #dc2626;
    color: #ffffff;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
}

.btn-danger:hover {
    background: #b91c1c;
}
</style>

<script>
// Dados globais
let currentMeetingId = null;
let currentMeetingStatus = 'draft';
let linkedProjectId = null;
let linkedProjectTitle = null;
let guestsInternal = [];
let guestsExternal = [];
let agendaItems = [];
let participants = {internal: [], external: []};
let discussions = [];
let activities = [];
let employeesData = [];

// Garantir que as funÁıes estejam disponÌveis globalmente
window.editarReuniao = null;
window.novaReuniao = null;
window.fecharEditor = null;

function updateProjectLinkDisplay(projectId, projectTitle) {
    linkedProjectId = projectId || null;
    if (linkedProjectId) {
        linkedProjectTitle = projectTitle || linkedProjectTitle;
    } else {
        linkedProjectTitle = projectTitle || null;
    }
    const display = document.getElementById('project-link-display');
    if (!display) {
        return;
    }
    if (linkedProjectId) {
        const titleHtml = linkedProjectTitle ? `<strong>${linkedProjectTitle}</strong> ¬∑ ` : '';
        display.innerHTML = `${titleHtml}<a href="/grv/company/13/project/${linkedProjectId}" target="_blank">Ver Projeto ?</a>`;
    } else {
        display.textContent = 'Nenhum';
    }
}

// Nova Reuni„o
window.novaReuniao = function() {
    console.log('Nova reuniao chamada');
    currentMeetingId = null;
    currentMeetingStatus = 'draft';
    document.getElementById('meeting-editor-title').textContent = 'Nova Reuni„o';
    limparFormulario();
    updateProjectLinkDisplay(null, null);
    updateMeetingStatus('draft');
    document.getElementById('meetings-list-section').style.display = 'none';
    document.getElementById('meeting-editor-section').style.display = 'block';
    trocarAba('preliminares');
    
    // Scroll to top
    window.scrollTo({top: 0, behavior: 'smooth'});
}

// Editar Reuni„o
window.editarReuniao = async function(meetingId) {
    console.log('Editar reuniao chamada com ID:', meetingId);
    currentMeetingId = meetingId;
    document.getElementById('meeting-editor-title').textContent = 'Editar Reuni„o';
    
    try {
        console.log('Fazendo requisiÁ„o para:', `/meetings/api/meeting/${meetingId}`);
        const response = await fetch(`/meetings/api/meeting/${meetingId}`);
        console.log('Status da resposta:', response.status);
        console.log('Resposta OK:', response.ok);
        
        const data = await response.json();
        console.log('Dados da resposta:', data);
        
        if (data.success) {
            const meeting = data.meeting;
            
            if (!meeting) {
                alert('Reuni√£o n√£o encontrada');
                return;
            }
            
            // Carregar dados
            document.getElementById('meeting-title').value = meeting.title || '';
            document.getElementById('meeting-scheduled-date').value = meeting.scheduled_date || '';
            document.getElementById('meeting-scheduled-time').value = meeting.scheduled_time || '';
            document.getElementById('meeting-invite-notes').value = meeting.invite_notes || '';
            document.getElementById('meeting-actual-date').value = meeting.actual_date || '';
            document.getElementById('meeting-actual-time').value = meeting.actual_time || '';
            document.getElementById('meeting-notes').value = meeting.meeting_notes || '';
            
            guestsInternal = meeting.guests?.internal || [];
            guestsExternal = meeting.guests?.external || [];
            agendaItems = meeting.agenda || [];
            participants = meeting.participants || {internal: [], external: []};
            discussions = meeting.discussions || [];
            activities = meeting.activities || [];
            
            updateProjectLinkDisplay(meeting.project_id || null, meeting.project_title || null);

            // Renderizar
            renderGuestsInternal();
            renderGuestsExternal();
            renderAgenda();
            renderParticipants();
            renderDiscussions();
            renderActivities();
            
            // Atualizar status
            updateMeetingStatus(meeting.status || 'draft');
            
            document.getElementById('meetings-list-section').style.display = 'none';
            document.getElementById('meeting-editor-section').style.display = 'block';
            
            // Scroll to top
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    } catch (error) {
        console.error('Erro em editarReuniao:', error);
        alert('Erro ao carregar reuni„o: ' + error.message);
    }
}

// Fechar Editor
window.fecharEditor = function() {
    document.getElementById('meeting-editor-section').style.display = 'none';
    document.getElementById('meetings-list-section').style.display = 'block';
    limparFormulario();
}

// Gerar RelatÛrio de Reuni„o Individual
window.gerarRelatorioReuniao = function(meetingId) {
    console.log('Gerar relatorio chamado para ID:', meetingId);
    // Abre o relatÛrio em nova aba
    const url = `/meetings/company/13/meeting/${meetingId}/report`;
    window.open(url, '_blank');
}

// Trocar Aba
function trocarAba(aba) {
    // Desativar todas
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
    
    // Ativar selecionada
    document.getElementById(`tab-${aba}`).classList.add('active');
    document.getElementById(`content-${aba}`).style.display = 'block';
}

// Adicionar Colaborador
function adicionarColaborador() {
    const select = document.getElementById('employee-select');
    const option = select.options[select.selectedIndex];
    
    if (!option.value) return;
    
    const guest = {
        id: option.value,
        name: option.dataset.name,
        email: option.dataset.email,
        whatsapp: option.dataset.whatsapp
    };
    
    if (!guestsInternal.find(g => g.id == guest.id)) {
        guestsInternal.push(guest);
        renderGuestsInternal();
    }
    
    select.value = '';
}

// Render Convidados Internos
function renderGuestsInternal() {
    const container = document.getElementById('guests-internal-list');
    container.innerHTML = guestsInternal.map((guest, index) => `
        <div class="guest-item">
            <div>
                <strong>${guest.name}</strong><br>
                <small>${guest.email || 'Sem e-mail'} | ${guest.whatsapp || 'Sem WhatsApp'}</small>
            </div>
            <button type="button" class="btn btn-sm btn-danger" onclick="removerGuestInternal(${index})">‚úï</button>
        </div>
    `).join('');
}

function removerGuestInternal(index) {
    guestsInternal.splice(index, 1);
    renderGuestsInternal();
}

// Adicionar Externo
function adicionarExterno() {
    const name = document.getElementById('external-name').value.trim();
    const email = document.getElementById('external-email').value.trim();
    const whatsapp = document.getElementById('external-whatsapp').value.trim();
    
    if (!name) return alert('Nome √© obrigat√≥rio');
    
    guestsExternal.push({name, email, whatsapp});
    document.getElementById('external-name').value = '';
    document.getElementById('external-email').value = '';
    document.getElementById('external-whatsapp').value = '';
    renderGuestsExternal();
}

// Render Convidados Externos
function renderGuestsExternal() {
    const container = document.getElementById('guests-external-list');
    container.innerHTML = guestsExternal.map((guest, index) => `
        <div class="guest-item">
            <div>
                <strong>${guest.name}</strong><br>
                <small>${guest.email || 'Sem e-mail'} | ${guest.whatsapp || 'Sem WhatsApp'}</small>
            </div>
            <button type="button" class="btn btn-sm btn-danger" onclick="removerGuestExternal(${index})">‚úï</button>
        </div>
    `).join('');
}

function removerGuestExternal(index) {
    guestsExternal.splice(index, 1);
    renderGuestsExternal();
}

// Adicionar Pauta
function adicionarPauta() {
    const input = document.getElementById('agenda-item-input');
    const title = input.value.trim();
    
    if (!title) return;
    
    agendaItems.push({title});
    input.value = '';
    renderAgenda();
}

// Render Pauta
function renderAgenda() {
    const container = document.getElementById('agenda-list');
    container.innerHTML = agendaItems.map((item, index) => `
        <div class="agenda-item">
            <span>${index + 1}. ${item.title}</span>
            <button type="button" class="btn btn-sm btn-danger" onclick="removerAgenda(${index})">‚úï</button>
        </div>
    `).join('');
}

function removerAgenda(index) {
    agendaItems.splice(index, 1);
    renderAgenda();
}

// Mostrar/Fechar Pauta Salva
function mostrarPautaSalva() {
    document.getElementById('saved-agenda-modal').style.display = 'block';
}

function fecharPautaSalva() {
    document.getElementById('saved-agenda-modal').style.display = 'none';
}

function usarPautaSalva(itemId, title) {
    agendaItems.push({title});
    renderAgenda();
    fetch(`/meetings/api/agenda-item/${itemId}/use`, {method: 'POST'});
    fecharPautaSalva();
}

// Salvar Dados Preliminares
async function salvarPreliminares() {
    const title = document.getElementById('meeting-title').value.trim();
    if (!title) return alert('T√≠tulo √© obrigat√≥rio');
    
    const data = {
        title,
        scheduled_date: document.getElementById('meeting-scheduled-date').value,
        scheduled_time: document.getElementById('meeting-scheduled-time').value,
        invite_notes: document.getElementById('meeting-invite-notes').value,
        guests: {internal: guestsInternal, external: guestsExternal},
        agenda: agendaItems
    };
    
    try {
        let response;
        if (currentMeetingId) {
            response = await fetch(`/meetings/api/meeting/${currentMeetingId}/preliminares`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
        } else {
            response = await fetch(`/meetings/api/company/13/meeting`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
        }
        
        const result = await response.json();
        if (result.success) {
            alert(result.message);
            if (result.meeting_id) currentMeetingId = result.meeting_id;
            location.reload();
        } else {
            alert('Erro: ' + result.message);
        }
    } catch (error) {
        alert('Erro ao salvar: ' + error.message);
    }
}

// Gerar Convite (.ics)
function gerarConvite() {
    const title = document.getElementById('meeting-title').value.trim();
    const date = document.getElementById('meeting-scheduled-date').value;
    const time = document.getElementById('meeting-scheduled-time').value;
    
    if (!title || !date) {
        return alert('T√≠tulo e data s√£o obrigat√≥rios para gerar convite');
    }
    
    // Formato b√°sico iCal
    const ics = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${title}
DTSTART:${date.replace(/-/g, '')}T${time ? time.replace(':', '') + '00' : '090000'}
DESCRIPTION:Reuni√£o: ${title}
END:VEVENT
END:VCALENDAR`;
    
    const blob = new Blob([ics], {type: 'text/calendar'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `reuniao-${title.replace(/\s+/g, '-').toLowerCase()}.ics`;
    a.click();
}

// Iniciar Reuni√£o
async function iniciarReuniao() {
    if (!currentMeetingId) return alert('Salve a reuni√£o primeiro');
    
    if (!confirm('Isso criar√° um projeto vinculado. Confirma?')) return;
    
    try {
        const response = await fetch(`/meetings/api/meeting/${currentMeetingId}/iniciar`, {
            method: 'POST'
        });
        const result = await response.json();
        
        if (result.success) {
            alert(result.message);
            updateMeetingStatus('in_progress');
            if (result.project_id) {
                updateProjectLinkDisplay(result.project_id, result.project_title || null);
            }
            const now = new Date();
            document.getElementById('meeting-actual-date').value = result.actual_date || now.toISOString().split('T')[0];
            document.getElementById('meeting-actual-time').value = result.actual_time || now.toTimeString().split(' ')[0].substring(0,5);
        } else {
            alert('Erro: ' + result.message);
        }
    } catch (error) {
        alert('Erro ao iniciar: ' + error.message);
    }
}

// Adicionar Discuss√£o
function adicionarDiscussao() {
    const container = document.getElementById('discussions-list');
    const index = discussions.length;
    discussions.push({title: '', discussion: ''});
    
    const html = `
        <div class="discussion-item" data-index="${index}" style="border: 1px solid var(--border-color); padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <input type="text" class="form-input" placeholder="T√≥pico / T√≠tulo" 
                       onchange="discussions[${index}].title = this.value" style="flex: 1; margin-right: 0.5rem;">
                <button type="button" class="btn btn-sm btn-danger" onclick="removerDiscussao(${index})">‚úï</button>
            </div>
            <textarea class="form-textarea" rows="3" placeholder="Discuss√£o e defini√ß√µes..."
                      onchange="discussions[${index}].discussion = this.value"></textarea>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
}

function removerDiscussao(index) {
    discussions.splice(index, 1);
    renderDiscussions();
}

function renderDiscussions() {
    const container = document.getElementById('discussions-list');
    container.innerHTML = discussions.map((disc, index) => `
        <div class="discussion-item" style="border: 1px solid var(--border-color); padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <input type="text" class="form-input" placeholder="T√≥pico / T√≠tulo" 
                       value="${disc.title || ''}"
                       onchange="discussions[${index}].title = this.value" style="flex: 1; margin-right: 0.5rem;">
                <button type="button" class="btn btn-sm btn-danger" onclick="removerDiscussao(${index})">‚úï</button>
            </div>
            <textarea class="form-textarea" rows="3" placeholder="Discuss√£o e defini√ß√µes..."
                      onchange="discussions[${index}].discussion = this.value">${disc.discussion || ''}</textarea>
        </div>
    `).join('');
}

// Adicionar Atividade
function adicionarAtividade() {
    const container = document.getElementById('activities-list');
    const index = activities.length;
    activities.push({title: '', responsible: '', deadline: '', how: '', project_id: null});
    
    const html = `
        <div class="activity-item" style="border: 1px solid var(--border-color); padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                <input type="text" class="form-input" placeholder="T√≠tulo da atividade" 
                       onchange="activities[${index}].title = this.value">
                <input type="text" class="form-input" placeholder="Respons√°vel" 
                       onchange="activities[${index}].responsible = this.value">
                <input type="date" class="form-input" 
                       onchange="activities[${index}].deadline = this.value">
                <button type="button" class="btn btn-sm btn-danger" onclick="removerAtividadeComConfirmacao(${index})">‚úï</button>
            </div>
            <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                <div>
                    <label class="form-label" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Como (Detalhes da Execu√ß√£o)</label>
                    <textarea class="form-textarea" rows="3" placeholder="Como ser√° executada a atividade"
                              onchange="activities[${index}].how = this.value"></textarea>
                </div>
                <div>
                    <label class="form-label" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Projeto</label>
                    <select class="form-input" onchange="activities[${index}].project_id = this.value">
                        <option value="">Padr√£o</option>
                        
                        <option value="33">2025.10.15 - Reuni„o Semanal Ordin·ria</option>
                        
                        <option value="34">2025.10 - Reuni„o de Diretoria - Mensal</option>
                        
                        <option value="41">Reuni„o Semanal Gerencial - 2025.10.14</option>
                        
                        <option value="42">Teste Fabiano Reuni„o 02 - 2025.10.17</option>
                        
                    </select>
                </div>
            </div>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', html);
}

function removerAtividade(index) {
    activities.splice(index, 1);
    renderActivities();
}

function renderActivities() {
    const container = document.getElementById('activities-list');
    container.innerHTML = activities.map((act, index) => `
        <div class="activity-item" style="border: 1px solid var(--border-color); padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                <input type="text" class="form-input" placeholder="T√≠tulo da atividade" 
                       value="${act.title || ''}"
                       onchange="activities[${index}].title = this.value">
                <input type="text" class="form-input" placeholder="Respons√°vel" 
                       value="${act.responsible || ''}"
                       onchange="activities[${index}].responsible = this.value">
                <input type="date" class="form-input" 
                       value="${act.deadline || ''}"
                       onchange="activities[${index}].deadline = this.value">
                <button type="button" class="btn btn-sm btn-danger" onclick="removerAtividadeComConfirmacao(${index})">‚úï</button>
            </div>
            <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                <div>
                    <label class="form-label" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Como (Detalhes da Execu√ß√£o)</label>
                    <textarea class="form-textarea" rows="3" placeholder="Como ser√° executada a atividade"
                              onchange="activities[${index}].how = this.value">${act.how || ''}</textarea>
                </div>
                <div>
                    <label class="form-label" style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Projeto</label>
                    <select class="form-input" onchange="activities[${index}].project_id = this.value">
                        <option value="">Padr√£o</option>
                        
                        <option value="33" ${act.project_id == "33" ? 'selected' : ''}>2025.10.15 - Reuni„o Semanal Ordin·ria</option>
                        
                        <option value="34" ${act.project_id == "34" ? 'selected' : ''}>2025.10 - Reuni„o de Diretoria - Mensal</option>
                        
                        <option value="41" ${act.project_id == "41" ? 'selected' : ''}>Reuni„o Semanal Gerencial - 2025.10.14</option>
                        
                        <option value="42" ${act.project_id == "42" ? 'selected' : ''}>Teste Fabiano Reuni„o 02 - 2025.10.17</option>
                        
                    </select>
                </div>
            </div>
        </div>
    `).join('');
}

// Adicionar Participante
function adicionarParticipante() {
    const select = document.getElementById('participant-select');
    const option = select.options[select.selectedIndex];
    
    if (!option.value) return;
    
    const participant = {
        id: option.value,
        name: option.dataset.name,
        email: option.dataset.email,
        whatsapp: option.dataset.whatsapp
    };
    
    if (!participants.internal.find(p => p.id == participant.id)) {
        participants.internal.push(participant);
        renderParticipants();
    }
    
    select.value = '';
}

function renderParticipants() {
    // Atualizar select com convidados
    const select = document.getElementById('participant-select');
    select.innerHTML = '<option value="">Selecionar dos convidados...</option>';
    
    [...guestsInternal, ...guestsExternal].forEach(guest => {
        select.innerHTML += `<option value="${guest.id || guest.name}" 
            data-name="${guest.name}"
            data-email="${guest.email || ''}"
            data-whatsapp="${guest.whatsapp || ''}">${guest.name}</option>`;
    });
    
    // Render lista
    const container = document.getElementById('participants-list');
    container.innerHTML = participants.internal.map((p, index) => `
        <div class="participant-item">
            <div>
                <strong>${p.name}</strong><br>
                <small>${p.email || ''} | ${p.whatsapp || ''}</small>
            </div>
            <button type="button" class="btn btn-sm btn-danger" onclick="removerParticipant(${index})">‚úï</button>
        </div>
    `).join('');
}

function removerParticipant(index) {
    participants.internal.splice(index, 1);
    renderParticipants();
}

// Salvar Execu√ß√£o
async function persistExecucao(options = {}) {
    const { silent = false } = options;

    if (!currentMeetingId) {
        if (!silent) alert('Reuni√£o n√£o encontrada');
        return { success: false, message: 'Reuni√£o n√£o encontrada' };
    }

    const payload = {
        actual_date: document.getElementById('meeting-actual-date').value,
        actual_time: document.getElementById('meeting-actual-time').value,
        participants,
        discussions,
        activities,
        meeting_notes: document.getElementById('meeting-notes').value,
        status: currentMeetingStatus
    };

    try {
        const response = await fetch(`/meetings/api/meeting/${currentMeetingId}/execucao`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (!result.success && !silent) {
            alert('Erro: ' + (result.message || 'Falha ao salvar execu√ß√£o'));
        }
        return result;
    } catch (error) {
        if (!silent) {
            alert('Erro ao salvar: ' + error.message);
        }
        return { success: false, message: error.message };
    }
}

async function salvarExecucao() {
    const result = await persistExecucao();
    if (result && result.success) {
        alert(result.message || 'Execu√ß√£o atualizada!');
    }
}

// Finalizar Reuni√£o
async function finalizarReuniao() {
    if (!currentMeetingId) return alert('Reuni√£o n√£o encontrada');
    
    if (!confirm('Isso criar√° uma atividade resumo no projeto. Confirma?')) return;
    
    try {
        const response = await fetch(`/meetings/api/meeting/${currentMeetingId}/finalizar`, {
            method: 'POST'
        });
        
        const result = await response.json();
        if (result.success) {
            alert(result.message);
            updateMeetingStatus('completed');
            trocarAba('atividades');
            atualizarAtividades();
        } else {
            alert('Erro: ' + result.message);
        }
    } catch (error) {
        alert('Erro ao finalizar: ' + error.message);
    }
}

// Atualizar Atividades
async function atualizarAtividades() {
    if (!currentMeetingId) return;

    try {
        const response = await fetch('/meetings/api/meeting/' + currentMeetingId + '/atividades');
        const result = await response.json();

        if (!result.success) {
            showMessage(result.message || 'Erro ao buscar atividades', 'error');
            return;
        }

        const container = document.getElementById('generated-activities-list');
        const projectActivities = result.project_activities || [];
        const meetingActivities = result.meeting_activities || [];

        const mergedMap = new Map();
        [...projectActivities, ...meetingActivities].forEach(act => {
            const key = [act.title || '', act.responsible || '', act.deadline || ''].join('|');
            if (!mergedMap.has(key)) {
                mergedMap.set(key, act);
            }
        });

        const mergedActivities = Array.from(mergedMap.values());

        if (!mergedActivities.length) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma atividade gerada ainda.</p>';
        } else {
            container.innerHTML = mergedActivities.map(act => `
                <div class="activity-item" style="margin-bottom: 0.5rem;">
                    <strong>${act.title || 'Atividade sem tÌtulo'}</strong><br>
                    <small>Respons·vel: ${act.responsible || 'N„o definido'} | Prazo: ${act.deadline || 'Sem prazo'}</small>
                </div>
            `).join('');
        }

        updateProjectLinkDisplay(result.project_id || linkedProjectId, result.project_title || linkedProjectTitle);
    } catch (error) {
        console.error('Erro ao buscar atividades:', error);
        showMessage('Erro ao buscar atividades: ' + error.message, 'error');
    }
}


// Update Meeting Status Display
function updateMeetingStatus(status) {
    currentMeetingStatus = status;
    const statusMap = {
        'draft': 'Rascunho',
        'in_progress': 'Em Andamento',
        'completed': 'Finalizada'
    };
    
    document.getElementById('meeting-status-display').textContent = statusMap[status] || status;
    
    const startButton = document.getElementById('btn-iniciar-reuniao');
    if (status === 'in_progress' || status === 'completed') {
        if (startButton) startButton.style.display = 'none';
    } else if (startButton) {
        startButton.style.display = 'inline-flex';
    }
    
    const finishButton = document.getElementById('btn-finalizar-reuniao');
    if (finishButton) {
        if (status === 'completed') {
            finishButton.disabled = true;
            finishButton.textContent = '‚úÖ Reuni√£o Finalizada';
        } else {
            finishButton.disabled = false;
            finishButton.textContent = '‚úî Finalizar Reuni√£o';
        }
    }
}

// Limpar Formul√°rio
function limparFormulario() {
    currentMeetingStatus = 'draft';
    document.getElementById('meeting-title').value = '';
    document.getElementById('meeting-scheduled-date').value = '';
    document.getElementById('meeting-scheduled-time').value = '';
    document.getElementById('meeting-invite-notes').value = '';
    document.getElementById('meeting-actual-date').value = '';
    document.getElementById('meeting-actual-time').value = '';
    document.getElementById('meeting-notes').value = '';
    
    updateProjectLinkDisplay(null, null);
    
    guestsInternal = [];
    guestsExternal = [];
    agendaItems = [];
    participants = {internal: [], external: []};
    discussions = [];
    activities = [];
    
    renderGuestsInternal();
    renderGuestsExternal();
    renderAgenda();
    renderParticipants();
    renderDiscussions();
    renderActivities();
    
    updateMeetingStatus('draft');
}

// ===== FUNCIONALIDADES DE SINCRONIZA√á√ÉO =====

async function atualizarListaAtividades(buttonEl) {
    const meetingId = currentMeetingId;
    const btn = buttonEl instanceof HTMLElement ? buttonEl : document.getElementById('sync-activities-btn');

    if (!meetingId) {
        showMessage('Salve a reuni√£o primeiro', 'error');
        if (btn) {
            btn.disabled = false;
            btn.innerHTML = '‚ü≥ Atualizar Lista';
        }
        return;
    }

    if (btn) {
        btn.disabled = true;
        btn.innerHTML = '‚ü≥ Verificando...';
    }

    const persistResult = await persistExecucao({ silent: true });
    if (!persistResult.success) {
        showMessage(persistResult.message || 'Erro ao salvar dados da reuni√£o antes da sincroniza√ß√£o', 'error');
        if (btn) {
            btn.disabled = false;
            btn.innerHTML = '‚ü≥ Atualizar Lista';
        }
        return;
    }

    try {
        const checkResponse = await fetch('/meetings/api/meeting/' + meetingId + '/check-sync');
        const checkData = await checkResponse.json();

        if (!checkData.success) {
            showMessage(checkData.message || 'Erro ao verificar sincroniza√ß√£o', 'error');
            return;
        }

        if (checkData.is_synced) {
            showMessage('? Atividades j· est„o sincronizadas!', 'success');
            return;
        }

        let message = '?? Status da SincronizaÁ„o:\n';
        message += 'ï Reuni„o: ' + checkData.meeting_count + ' atividades\n';
        message += 'ï Projeto: ' + checkData.project_count + ' atividades\n';

        if (checkData.missing_in_project.length > 0) {
            message += 'ï Faltando no projeto: ' + checkData.missing_in_project.join(', ') + '\n';
        }

        if (checkData.extra_in_project.length > 0) {
            message += 'ï Extras no projeto: ' + checkData.extra_in_project.join(', ') + '\n';
        }

        const confirmSync = confirm(message + '\nDeseja sincronizar as atividades?');
        if (!confirmSync) {
            return;
        }

        if (btn) {
            btn.innerHTML = '‚ü≥ Sincronizando...';
        }

        const payload = {
            activities,
            participants,
            discussions,
            meeting_notes: document.getElementById('meeting-notes').value,
            status: currentMeetingStatus,
            actual_date: document.getElementById('meeting-actual-date').value,
            actual_time: document.getElementById('meeting-actual-time').value
        };

        const syncResponse = await fetch('/meetings/api/meeting/' + meetingId + '/sync-activities', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const syncData = await syncResponse.json();

        if (syncData.success) {
            showMessage('? ' + syncData.message + ' (' + syncData.synced_count + ' atividades)', 'success');
            if (syncData.project_id) {
                updateProjectLinkDisplay(syncData.project_id, syncData.project_title || linkedProjectTitle);
            }
            await atualizarAtividades();
        } else {
            showMessage('‚ùå ' + syncData.message, 'error');
        }

    } catch (error) {
        console.error('Erro ao sincronizar atividades:', error);
        showMessage('‚ùå Erro ao sincronizar atividades', 'error');
    } finally {
        if (btn) {
            btn.innerHTML = '‚ü≥ Atualizar Lista';
            btn.disabled = false;
        }
    }
}

async function removerAtividadeComConfirmacao(index) {
    const activity = activities[index];

    const confirmRemoval = confirm('Ao remover, a atividade ser√° exclu√≠da da reuni√£o e do projeto vinculado (quando existir). Deseja continuar?');
    if (!confirmRemoval) {
        return;
    }

    const meetingId = currentMeetingId;

    if (meetingId && linkedProjectId && activity && activity.title) {
        try {
            await fetch('/meetings/api/meeting/' + meetingId + '/remove-from-project', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: activity.title })
            });
        } catch (error) {
            console.error('Erro ao remover atividade do projeto:', error);
        }
    }

    removerAtividade(index);
    await persistExecucao({ silent: true });
    await atualizarAtividades();
}

// Verificar se as funÁıes foram definidas corretamente
console.log('FunÁıes definidas:');
console.log('  - editarReuniao:', typeof window.editarReuniao);
console.log('  - novaReuniao:', typeof window.novaReuniao);
console.log('  - fecharEditor:', typeof window.fecharEditor);
console.log('  - gerarRelatorioReuniao:', typeof window.gerarRelatorioReuniao);

// Carregar dados dos funcion·rios de forma segura
document.addEventListener('DOMContentLoaded', function() {
    try {
        employeesData = [{"email": null, "id": 13, "name": "Erika", "whatsapp": null}, {"email": null, "id": 25, "name": "Fabiano", "whatsapp": null}, {"email": null, "id": 16, "name": "Joseane", "whatsapp": null}, {"email": null, "id": 15, "name": "Manoel", "whatsapp": null}, {"email": null, "id": 12, "name": "Marcel", "whatsapp": null}, {"email": null, "id": 17, "name": "Thais", "whatsapp": null}, {"email": null, "id": 14, "name": "Vicente", "whatsapp": null}, {"email": null, "id": 26, "name": "Wagner", "whatsapp": null}];
        console.log('Dados dos funcion·rios carregados:', employeesData.length);
    } catch (e) {
        console.error('Erro ao carregar dados dos funcion·rios:', e);
        employeesData = [];
    }
});

</script>


    </main>
  </div>

  
  
  <script>
    (function(){
      const themeMap = {
        versus: '',
        alt: '/static/css/theme-alt.css'
      };
      function applyTheme(theme){
        const link = document.getElementById('themeStylesheet');
        const href = themeMap[theme] || '';
        link.setAttribute('href', href);
        localStorage.setItem('app_theme', theme);
      }
      function initTheme(){
        const params = new URLSearchParams(window.location.search);
        const queryTheme = params.get('theme');
        const stored = localStorage.getItem('app_theme');
        let theme = queryTheme || stored || 'versus';
        if(theme === 'blue' || theme === 'white' || theme === 'yellow'){ theme = 'alt'; }
        applyTheme(theme);
        const sel = document.getElementById('themeSelect');
        if(sel){ sel.value = theme; sel.addEventListener('change', () => applyTheme(sel.value)); }
      }
      document.addEventListener('DOMContentLoaded', initTheme);
    })();
  </script>
  <script>
    window.showMessage = window.showMessage || function(message, type = 'info', timeout = 5000) {
      const containerId = 'global-feedback-messages';
      let container = document.getElementById(containerId);
      if (!container) {
        container = document.createElement('div');
        container.id = containerId;
        container.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          display: flex;
          flex-direction: column;
          gap: 12px;
          z-index: 1100;
        `;
        document.body.appendChild(container);
      }

      const messageDiv = document.createElement('div');
      messageDiv.className = `message message-${type}`;
      messageDiv.textContent = message;
      messageDiv.style.cssText = `
        padding: 12px 20px;
        border-radius: 4px;
        color: #fff;
        font-weight: 500;
        max-width: 420px;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.2);
        display: flex;
        align-items: center;
        gap: 12px;
        background-color: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        transform: translateX(120%);
        transition: transform 0.25s ease-out;
      `;

      const closeButton = document.createElement('button');
      closeButton.type = 'button';
      closeButton.textContent = '?';
      closeButton.style.cssText = `
        margin-left: auto;
        border: none;
        background: transparent;
        color: inherit;
        font-size: 16px;
        cursor: pointer;
      `;
      closeButton.addEventListener('click', () => {
        messageDiv.style.transform = 'translateX(120%)';
        setTimeout(() => messageDiv.remove(), 250);
      });

      messageDiv.appendChild(closeButton);
      container.appendChild(messageDiv);

      requestAnimationFrame(() => {
        messageDiv.style.transform = 'translateX(0)';
      });

      if (timeout > 0) {
        setTimeout(() => {
          messageDiv.style.transform = 'translateX(120%)';
          setTimeout(() => messageDiv.remove(), 250);
        }, timeout);
      }

      return messageDiv;
    };
  </script>
  <script>
    // Auto-hide flash messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
      const flashMessages = document.querySelectorAll('.flash-message');
      flashMessages.forEach(function(message) {
        setTimeout(function() {
          message.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(function() {
            message.remove();
          }, 300);
        }, 5000);
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const storageKey = 'grv_sidebar_collapsed';

      document.querySelectorAll('.plan-layout[data-sidebar-toggle]').forEach(function(layout) {
        if (layout.dataset.sidebarToggleReady === 'true') {
          return;
        }

        const sidebar = layout.querySelector('.project-sidebar');
        const content = layout.querySelector('.project-content');
        if (!sidebar || !content) {
          return;
        }

        layout.dataset.sidebarToggleReady = 'true';

        const wrapper = document.createElement('div');
        wrapper.className = 'project-sidebar-toggle-wrapper';

        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'project-sidebar-toggle';
        button.innerHTML = '<span class="toggle-icon">|||</span><span class="toggle-label">Ocultar menu</span>';
        button.setAttribute('aria-expanded', 'true');

        wrapper.appendChild(button);
        content.insertBefore(wrapper, content.firstChild);

        const applyState = function(collapsed) {
          layout.dataset.sidebarCollapsed = collapsed ? 'true' : 'false';
          if (collapsed) {
            layout.style.gridTemplateColumns = 'minmax(0, 1fr)';
            sidebar.style.display = 'none';
          } else {
            layout.style.gridTemplateColumns = '';
            sidebar.style.display = '';
          }

          button.setAttribute('aria-expanded', collapsed ? 'false' : 'true');
          const label = button.querySelector('.toggle-label');
          if (label) {
            label.textContent = collapsed ? 'Mostrar menu' : 'Ocultar menu';
          }
        };

        let collapsed = false;
        try {
          collapsed = localStorage.getItem(storageKey) === 'true';
        } catch (err) {
          collapsed = false;
        }

        applyState(collapsed);

        button.addEventListener('click', function() {
          collapsed = !collapsed;
          applyState(collapsed);
          try {
            localStorage.setItem(storageKey, collapsed ? 'true' : 'false');
          } catch (err) {
            // ignore persistence errors
          }
        });
      });
    });
  </script>
  
  <style>
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  </style>
</body>
</html>
