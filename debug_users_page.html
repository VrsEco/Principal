<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - P√°gina de Usu√°rios</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-section h2 {
            color: #667eea;
            margin-top: 0;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin: 0.5rem;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .result {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 1rem;
            margin: 1rem 0;
        }
        .error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            margin: 1rem 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <h1>üîç Debug - P√°gina de Usu√°rios</h1>

    <!-- Teste 1: Verificar Login -->
    <div class="debug-section">
        <h2>1Ô∏è‚É£ Verificar Status de Login</h2>
        <button class="test-button" onclick="checkLogin()">üîê Verificar Login</button>
        <div id="login-result" class="result">Clique no bot√£o para testar...</div>
    </div>

    <!-- Teste 2: Buscar HTML da P√°gina -->
    <div class="debug-section">
        <h2>2Ô∏è‚É£ Buscar HTML da P√°gina de Usu√°rios</h2>
        <button class="test-button" onclick="fetchUsersPage()">üìÑ Buscar HTML</button>
        <div id="html-result" class="result">Clique no bot√£o para testar...</div>
    </div>

    <!-- Teste 3: Verificar Bot√£o -->
    <div class="debug-section">
        <h2>3Ô∏è‚É£ Procurar Bot√£o "Novo Usu√°rio" no HTML</h2>
        <button class="test-button" onclick="searchButton()">üîé Procurar Bot√£o</button>
        <div id="button-result" class="result">Clique no bot√£o para testar...</div>
    </div>

    <!-- Teste 4: Verificar CSS -->
    <div class="debug-section">
        <h2>4Ô∏è‚É£ Verificar Estilos CSS</h2>
        <button class="test-button" onclick="checkCSS()">üé® Verificar CSS</button>
        <div id="css-result" class="result">Clique no bot√£o para testar...</div>
    </div>

    <!-- Teste 5: Abrir P√°gina em Nova Aba -->
    <div class="debug-section">
        <h2>5Ô∏è‚É£ Abrir P√°gina de Usu√°rios</h2>
        <button class="test-button" onclick="window.open('http://127.0.0.1:5003/auth/users/page', '_blank')">
            üåê Abrir em Nova Aba
        </button>
        <div class="warning">
            <strong>‚ö†Ô∏è Instru√ß√µes:</strong><br>
            1. Clique no bot√£o acima<br>
            2. Na nova aba, pressione <strong>F12</strong><br>
            3. V√° em <strong>Console</strong><br>
            4. Digite: <code>document.querySelector('.btn-primary')</code><br>
            5. Pressione Enter
        </div>
    </div>

    <!-- Teste 6: Limpar Cache -->
    <div class="debug-section">
        <h2>6Ô∏è‚É£ Limpar Cache e Recarregar</h2>
        <div class="warning">
            <strong>‚ö†Ô∏è Fa√ßa isso na p√°gina de usu√°rios:</strong><br>
            1. Abra: http://127.0.0.1:5003/auth/users/page<br>
            2. Pressione: <strong>Ctrl + Shift + Delete</strong><br>
            3. Marque: "Cache" e "Cookies"<br>
            4. Clique: "Limpar dados"<br>
            5. Pressione: <strong>Ctrl + F5</strong> (for√ßa recarga)
        </div>
    </div>

    <script>
        let cachedHTML = '';

        async function checkLogin() {
            const result = document.getElementById('login-result');
            try {
                const response = await fetch('http://127.0.0.1:5003/auth/current-user');
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `‚úÖ LOGADO COM SUCESSO!\n\n` +
                        `Nome: ${data.user.name}\n` +
                        `Email: ${data.user.email}\n` +
                        `Role: ${data.user.role}\n` +
                        `Ativo: ${data.user.is_active}\n\n` +
                        `${data.user.role === 'admin' ? '‚úÖ √â ADMINISTRADOR - Tem permiss√£o para ver os bot√µes' : '‚ùå N√ÉO √© administrador'}`;
                    result.className = 'result success';
                } else {
                    result.innerHTML = `‚ùå N√ÉO EST√Å LOGADO!\n\nFa√ßa login primeiro em:\nhttp://127.0.0.1:5003/login`;
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = `‚ùå ERRO ao verificar login:\n\n${error}`;
                result.className = 'result error';
            }
        }

        async function fetchUsersPage() {
            const result = document.getElementById('html-result');
            result.innerHTML = '‚è≥ Buscando HTML...';
            
            try {
                const response = await fetch('http://127.0.0.1:5003/auth/users/page');
                const html = await response.text();
                cachedHTML = html;
                
                // Verificar se foi redirecionado para login
                if (html.includes('Redirecting')) {
                    result.innerHTML = `‚ùå P√ÅGINA REDIRECIONOU PARA LOGIN!\n\nVoc√™ n√£o est√° logado ou a sess√£o expirou.\n\nFa√ßa login em: http://127.0.0.1:5003/login`;
                    result.className = 'result error';
                    return;
                }
                
                // Mostrar primeiros 500 caracteres
                const preview = html.substring(0, 500);
                result.innerHTML = `‚úÖ HTML RECEBIDO (${html.length} caracteres)\n\nPrimeiros 500 caracteres:\n${preview}\n\n...(clique em "Procurar Bot√£o" para continuar)`;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `‚ùå ERRO ao buscar p√°gina:\n\n${error}`;
                result.className = 'result error';
            }
        }

        async function searchButton() {
            const result = document.getElementById('button-result');
            
            if (!cachedHTML) {
                result.innerHTML = '‚ö†Ô∏è Primeiro execute "Buscar HTML" acima!';
                result.className = 'result warning';
                return;
            }
            
            result.innerHTML = 'üîé Procurando bot√£o no HTML...';
            
            // Procurar padr√µes
            const patterns = [
                'Novo Usu√°rio',
                'btn-primary',
                'auth.register',
                'fa-plus',
                'page-header'
            ];
            
            let findings = '';
            for (const pattern of patterns) {
                const found = cachedHTML.includes(pattern);
                const count = (cachedHTML.match(new RegExp(pattern, 'g')) || []).length;
                findings += `${found ? '‚úÖ' : '‚ùå'} "${pattern}": ${found ? `ENCONTRADO (${count}x)` : 'N√ÉO ENCONTRADO'}\n`;
            }
            
            // Extrair trecho do bot√£o se existir
            const btnIndex = cachedHTML.indexOf('Novo Usu√°rio');
            if (btnIndex !== -1) {
                const start = Math.max(0, btnIndex - 200);
                const end = Math.min(cachedHTML.length, btnIndex + 200);
                const excerpt = cachedHTML.substring(start, end);
                findings += `\nüìÑ TRECHO DO HTML onde est√° "Novo Usu√°rio":\n\n${excerpt}`;
                result.className = 'result success';
            } else {
                findings += `\n‚ùå BOT√ÉO "Novo Usu√°rio" N√ÉO ENCONTRADO NO HTML!`;
                result.className = 'result error';
            }
            
            result.innerHTML = findings;
        }

        async function checkCSS() {
            const result = document.getElementById('css-result');
            result.innerHTML = `üìã INSTRU√á√ïES PARA VERIFICAR CSS:\n\n` +
                `1. Abra a p√°gina de usu√°rios em nova aba\n` +
                `2. Pressione F12 para abrir DevTools\n` +
                `3. V√° na aba "Elements" ou "Elementos"\n` +
                `4. Pressione Ctrl+F para buscar\n` +
                `5. Procure por: "Novo Usu√°rio"\n` +
                `6. Se encontrar, clique com bot√£o direito\n` +
                `7. Selecione "Inspect" ou "Inspecionar"\n` +
                `8. Verifique o painel "Styles" √† direita\n` +
                `9. Procure por:\n` +
                `   - display: none\n` +
                `   - visibility: hidden\n` +
                `   - opacity: 0\n\n` +
                `Se algum desses estiver ativo, √© um problema de CSS!`;
            result.className = 'result warning';
        }

        // Executar teste de login automaticamente
        window.addEventListener('load', () => {
            setTimeout(checkLogin, 1000);
        });
    </script>
</body>
</html>


